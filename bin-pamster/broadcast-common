# -*- mode: sh; sh-shell: bash -*-

## This exists to be sourced by other scripts to factor out common code.

function error {
    echo "$@" 1>&2
    exit 1
}

function main {
    if [[ "$(hostname)" != pamster ]]; then
        error "must run this from pamster"
    fi

    echo "Pulling from dmi-skinny..."
    ssh dmi-skinny "$@"
    echo

    echo "Assuming that VPN is DOWN on dmi-skinny..."
    echo "Pulling from nils..."
    ## As of 2025-08-10, from the VPN I cannot get to nils, hence the
    ## extra hop via dmi-skinny.
    ssh dmi-skinny ssh nils "$@"
    echo

    echo "Assuming that kruemel is powered on..."
    echo "Pulling from kruemel..."
    ssh kruemel "$@"
    echo

    echo "Assuming that VPN is up..."
    echo "Pulling from dmi-kibo..."
    ssh kibo "$@"
    echo

    echo "Assuming that VPN is up..."
    echo "Pulling from grid..."
    ssh grid "$@"
    echo

    echo "Done."
}
